<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Pivot Tables in R • pivottabler</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><!-- docsearch --><script src="docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Create Pivot Tables in R">
<meta property="og:description" content="Create regular pivot tables with just a few lines of R.  
    More complex pivot tables can also be created, e.g. pivot tables
    with irregular layouts, multiple calculations and/or derived 
    calculations based on multiple data frames.  Pivot tables are
    constructed using R only and can be written to a range of
    output formats (plain text, HTML, Latex and Excel), 
    including with styling/formatting.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-64707587-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-64707587-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">pivottabler</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="articles/index.html">Articles</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cbailiss/pivottabler/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="pivottabler" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#pivottabler" class="anchor"></a>pivottabler</h1></div>

<p>The <code>pivottabler</code> package enables pivot tables to be created with just a few lines of R.</p>
<p>The <code>pivottabler</code> package aims to:</p>
<ul>
<li>Provide an easy way of creating pivot tables, without requiring the user to specify low-level layout logic.</li>
<li>Provide multiple ways of specifying calculation logic to cover both simple and more sophisticated requirements.</li>
<li>Provide styling options so the pivot tables can be themed/branded as needed.</li>
</ul>
<p>All calculations for the pivot tables take place inside R, enabling the use of a wide-range of R functions in the calculation logic.</p>
<p>Pivot tables are rendered as htmlwidgets, Latex or plain text. The HTML/Latex/text can be exported for use outside of R.</p>
<p>Pivot tables can be converted to a standard R matrix or data frame. Pivot tables can be exported to Excel. Pivot tables can also be converted to a <code>basictabler</code> table for further manipulation.</p>
<p><code>pivottabler</code> is a companion package to the <code>basictabler</code> package. <code>pivottabler</code> is focussed on generating pivot tables and can aggregate data. <code>basictabler</code> does not aggregate data but offers more control of table structure.</p>
<p>For more detailed information see <a href="http://www.pivottabler.org.uk/articles" class="uri">http://www.pivottabler.org.uk/articles</a>.</p>
<div id="installation" class="section level3">
<h3 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h3>
<p>You can install:</p>
<ul>
<li>the latest released version from CRAN with</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"pivottabler"</span>)</pre></div>
<ul>
<li>the latest development version from GitHub with</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="r"><span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"cbailiss/pivottabler"</span>, <span class="kw">build_vignettes</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></div>
</div>
<div id="example" class="section level3">
<h3 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h3>
<p><code>pivottabler</code> has many styling and formatting capabilities when rendering pivot tables in HTML / as htmlwidgets using <code>pt$renderPivot()</code>, however the most basic output is simply as plain text.</p>
<div id="plain-text-output" class="section level4">
<h4 class="hasAnchor">
<a href="#plain-text-output" class="anchor"></a>Plain Text Output</h4>
<p>A simple example of creating a pivot table - summarising the types of trains run by different train companies:</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="co"># arguments:  qpvt(dataFrame, rows, columns, calculations, ...)</span>
<span class="fu"><a href="reference/qpvt.html">qpvt</a></span>(<span class="no">bhmtrains</span>, <span class="st">"TOC"</span>, <span class="st">"TrainCategory"</span>, <span class="st">"n()"</span>) <span class="co"># TOC = Train Operating Company </span></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">                     Express Passenger  Ordinary Passenger  Total  </a>
<a class="sourceLine" id="cb4-2" title="2">Arriva Trains Wales               <span class="dv">3079</span>                 <span class="dv">830</span>   <span class="dv">3909</span>  </a>
<a class="sourceLine" id="cb4-3" title="3">CrossCountry                     <span class="dv">22865</span>                  <span class="dv">63</span>  <span class="dv">22928</span>  </a>
<a class="sourceLine" id="cb4-4" title="4">London Midland                   <span class="dv">14487</span>               <span class="dv">33792</span>  <span class="dv">48279</span>  </a>
<a class="sourceLine" id="cb4-5" title="5">Virgin Trains                     <span class="dv">8594</span>                       <span class="dv">8594</span>  </a>
<a class="sourceLine" id="cb4-6" title="6">Total                            <span class="dv">49025</span>               <span class="dv">34685</span>  <span class="dv">83710</span>  </a></code></pre></div>
<p><code>pivottabler</code> also offers a more verbose syntax that is more self-describing and offers additional options that aren’t available with the quick-pivot functions. The equivalent verbose commands to output the same pivot table as above are:</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="no">pt</span> <span class="kw">&lt;-</span> <span class="no">PivotTable</span>$<span class="fu">new</span>()
<span class="no">pt</span>$<span class="fu">addData</span>(<span class="no">bhmtrains</span>) <span class="co"># bhmtrains is a data frame with columns TrainCategory, TOC, etc.</span>
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"TrainCategory"</span>) <span class="co"># e.g. Express Passenger</span>
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"TOC"</span>) <span class="co"># TOC = Train Operating Company e.g. Arriva Trains Wales</span>
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"TotalTrains"</span>, <span class="kw">summariseExpression</span><span class="kw">=</span><span class="st">"n()"</span>)
<span class="no">pt</span>$<span class="fu">evaluatePivot</span>()
<span class="no">pt</span></pre></div>
<p>Multiple levels can be added to the pivot table row or column headings, e.g. looking at combinations of TOC and PowerType:</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="fu"><a href="reference/qpvt.html">qpvt</a></span>(<span class="no">bhmtrains</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TOC"</span>, <span class="st">"PowerType"</span>), <span class="st">"TrainCategory"</span>, <span class="st">"n()"</span>)</pre></div>
<div class="sourceCode" id="cb7"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="no">pt</span> <span class="kw">&lt;-</span> <span class="no">PivotTable</span>$<span class="fu">new</span>()
<span class="no">pt</span>$<span class="fu">addData</span>(<span class="no">bhmtrains</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"TrainCategory"</span>)
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"TOC"</span>)
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"PowerType"</span>) <span class="co"># D/EMU = Diesel/Electric Multiple Unit, HST=High Speed Train</span>
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"TotalTrains"</span>, <span class="kw">summariseExpression</span><span class="kw">=</span><span class="st">"n()"</span>)
<span class="no">pt</span>$<span class="fu">evaluatePivot</span>()
<span class="no">pt</span></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">                            Express Passenger  Ordinary Passenger  Total  </a>
<a class="sourceLine" id="cb8-2" title="2">Arriva Trains Wales  DMU                 <span class="dv">3079</span>                 <span class="dv">830</span>   <span class="dv">3909</span>  </a>
<a class="sourceLine" id="cb8-3" title="3">                     Total               <span class="dv">3079</span>                 <span class="dv">830</span>   <span class="dv">3909</span>  </a>
<a class="sourceLine" id="cb8-4" title="4">CrossCountry         DMU                <span class="dv">22133</span>                  <span class="dv">63</span>  <span class="dv">22196</span>  </a>
<a class="sourceLine" id="cb8-5" title="5">                     HST                  <span class="dv">732</span>                        <span class="dv">732</span>  </a>
<a class="sourceLine" id="cb8-6" title="6">                     Total              <span class="dv">22865</span>                  <span class="dv">63</span>  <span class="dv">22928</span>  </a>
<a class="sourceLine" id="cb8-7" title="7">London Midland       DMU                 <span class="dv">5638</span>                <span class="dv">5591</span>  <span class="dv">11229</span>  </a>
<a class="sourceLine" id="cb8-8" title="8">                     EMU                 <span class="dv">8849</span>               <span class="dv">28201</span>  <span class="dv">37050</span>  </a>
<a class="sourceLine" id="cb8-9" title="9">                     Total              <span class="dv">14487</span>               <span class="dv">33792</span>  <span class="dv">48279</span>  </a>
<a class="sourceLine" id="cb8-10" title="10">Virgin Trains        DMU                 <span class="dv">2137</span>                       <span class="dv">2137</span>  </a>
<a class="sourceLine" id="cb8-11" title="11">                     EMU                 <span class="dv">6457</span>                       <span class="dv">6457</span>  </a>
<a class="sourceLine" id="cb8-12" title="12">                     Total               <span class="dv">8594</span>                       <span class="dv">8594</span>  </a>
<a class="sourceLine" id="cb8-13" title="13">Total                                   <span class="dv">49025</span>               <span class="dv">34685</span>  <span class="dv">83710</span>  </a></code></pre></div>
</div>
<div id="html-output" class="section level4">
<h4 class="hasAnchor">
<a href="#html-output" class="anchor"></a>HTML Output</h4>
<p>The HTML rendering of the same two pivot tables shown above (each constructed using both a quick-pivot function and verbose syntax) is:</p>
<div class="sourceCode" id="cb9"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="fu"><a href="reference/qhpvt.html">qhpvt</a></span>(<span class="no">bhmtrains</span>, <span class="st">"TOC"</span>, <span class="st">"TrainCategory"</span>, <span class="st">"n()"</span>)</pre></div>
<div class="sourceCode" id="cb10"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="no">pt</span> <span class="kw">&lt;-</span> <span class="no">PivotTable</span>$<span class="fu">new</span>()
<span class="no">pt</span>$<span class="fu">addData</span>(<span class="no">bhmtrains</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"TrainCategory"</span>)
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"TOC"</span>)
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"TotalTrains"</span>, <span class="kw">summariseExpression</span><span class="kw">=</span><span class="st">"n()"</span>)
<span class="no">pt</span>$<span class="fu">renderPivot</span>()</pre></div>
<p><img src="http://cbailiss.me.uk/pivottablerreadmeimgs/example1.png" alt="http://cbailiss.me.uk/pivottablerreadmeimgs/example1.png"></p>
<div class="sourceCode" id="cb11"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="fu"><a href="reference/qhpvt.html">qhpvt</a></span>(<span class="no">bhmtrains</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TOC"</span>, <span class="st">"PowerType"</span>), <span class="st">"TrainCategory"</span>, <span class="st">"n()"</span>)</pre></div>
<div class="sourceCode" id="cb12"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="no">pt</span> <span class="kw">&lt;-</span> <span class="no">PivotTable</span>$<span class="fu">new</span>()
<span class="no">pt</span>$<span class="fu">addData</span>(<span class="no">bhmtrains</span>) <span class="co"># bhmtrains is a data frame with columns TrainCategory, TOC, etc.</span>
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"TrainCategory"</span>) <span class="co"># e.g. Express Passenger</span>
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"TOC"</span>) <span class="co"># TOC = Train Operating Company e.g. Arriva Trains Wales</span>
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"PowerType"</span>) <span class="co"># D/EMU = Diesel/Electric Multiple Unit, HST=High Speed Train</span>
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"TotalTrains"</span>, <span class="kw">summariseExpression</span><span class="kw">=</span><span class="st">"n()"</span>)
<span class="no">pt</span>$<span class="fu">renderPivot</span>()</pre></div>
<p><img src="http://cbailiss.me.uk/pivottablerreadmeimgs/example2.png" alt="http://cbailiss.me.uk/pivottablerreadmeimgs/example2.png"></p>
<p>Outline layout is an alternative way of rendering the row groups, e.g. for the same pivot table as above:</p>
<div class="sourceCode" id="cb13"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="no">pt</span> <span class="kw">&lt;-</span> <span class="no">PivotTable</span>$<span class="fu">new</span>()
<span class="no">pt</span>$<span class="fu">addData</span>(<span class="no">bhmtrains</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"TrainCategory"</span>)
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"TOC"</span>,
                    <span class="kw">outlineBefore</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">isEmpty</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">groupStyleDeclarations</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">color</span><span class="kw">=</span><span class="st">"blue"</span>)),
                    <span class="kw">outlineTotal</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">isEmpty</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">groupStyleDeclarations</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">color</span><span class="kw">=</span><span class="st">"blue"</span>)))
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"PowerType"</span>, <span class="kw">addTotal</span><span class="kw">=</span><span class="fl">FALSE</span>)
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"TotalTrains"</span>, <span class="kw">summariseExpression</span><span class="kw">=</span><span class="st">"n()"</span>)
<span class="no">pt</span>$<span class="fu">renderPivot</span>()</pre></div>
<p><img src="http://cbailiss.me.uk/pivottablerreadmeimgs/example7.png" alt="http://cbailiss.me.uk/pivottablerreadmeimgs/example7.png"></p>
<p>Outline layout can also be used to build a pivot table with a variable depth hierarchy on the rows, e.g. a simple balance sheet:</p>
<p><img src="http://cbailiss.me.uk/pivottablerreadmeimgs/example8.png" alt="http://cbailiss.me.uk/pivottablerreadmeimgs/example8.png"></p>
<p>The R for generating the above pivot table can be found in the Regular Layout vignette at <a href="http://www.pivottabler.org.uk/articles" class="uri">http://www.pivottabler.org.uk/articles</a>.</p>
</div>
<div id="multiple-calculations" class="section level4">
<h4 class="hasAnchor">
<a href="#multiple-calculations" class="anchor"></a>Multiple Calculations</h4>
<p>Multiple calculations are supported. Calculations can be based on other calculations in the pivot table. Calculations can be hidden - e.g. to hide calculations that only exist to provide values to other calculations.</p>
<p>For example, looking at the total number of trains and the percentage of trains that arrive more than five minutes late for combinations of train operating company (TOC) and train category:</p>
<div class="sourceCode" id="cb14"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lubridate</span>)

<span class="co"># derive train delay data</span>
<span class="no">trains</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="no">bhmtrains</span>,
                 <span class="kw">ArrivalDelta</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span>(<span class="no">ActualArrival</span>, <span class="no">GbttArrival</span>, <span class="kw">units</span><span class="kw">=</span><span class="st">"mins"</span>),
                 <span class="kw">ArrivalDelay</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">ArrivalDelta</span><span class="kw">&lt;</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="no">ArrivalDelta</span>),
                 <span class="kw">DelayedByMoreThan5Minutes</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">ArrivalDelay</span><span class="kw">&gt;=</span><span class="fl">5</span>,<span class="fl">1</span>,<span class="fl">0</span>))

<span class="co"># create the pivot table</span>
<span class="no">pt</span> <span class="kw">&lt;-</span> <span class="no">PivotTable</span>$<span class="fu">new</span>()
<span class="no">pt</span>$<span class="fu">addData</span>(<span class="no">trains</span>)
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"TOC"</span>, <span class="kw">totalCaption</span><span class="kw">=</span><span class="st">"All TOCs"</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"TrainCategory"</span>, <span class="kw">totalCaption</span><span class="kw">=</span><span class="st">"All Trains"</span>)
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"TotalTrains"</span>, <span class="kw">caption</span><span class="kw">=</span><span class="st">"Train Count"</span>,
                     <span class="kw">summariseExpression</span><span class="kw">=</span><span class="st">"n()"</span>)
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"DelayedTrains"</span>, <span class="kw">caption</span><span class="kw">=</span><span class="st">"Trains Arr. 5+ Mins Late"</span>,
                     <span class="kw">summariseExpression</span><span class="kw">=</span><span class="st">"sum(DelayedByMoreThan5Minutes, na.rm=TRUE)"</span>,
                     <span class="kw">visible</span><span class="kw">=</span><span class="fl">FALSE</span>)
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"DelayedPercent"</span>, <span class="kw">caption</span><span class="kw">=</span><span class="st">"% Late Trains"</span>,
                     <span class="kw">type</span><span class="kw">=</span><span class="st">"calculation"</span>, <span class="kw">basedOn</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"DelayedTrains"</span>, <span class="st">"TotalTrains"</span>),
                     <span class="kw">format</span><span class="kw">=</span><span class="st">"%.1f %%"</span>,
                     <span class="kw">calculationExpression</span><span class="kw">=</span><span class="st">"values$DelayedTrains/values$TotalTrains*100"</span>)
<span class="no">pt</span>$<span class="fu">renderPivot</span>()</pre></div>
<p><img src="http://cbailiss.me.uk/pivottablerreadmeimgs/example6.png" alt="http://cbailiss.me.uk/pivottablerreadmeimgs/example6.png"></p>
<p>It is also possible to change the axis (rows or columns) and level in which the calculations appear. See the “Calculations” vignette for details.</p>
<p>More advanced calculations such as % of row total, cumulative sums, etc are possible. See the “A2. Appendix: Calculations” vignette for details.</p>
</div>
<div id="styling-example" class="section level4">
<h4 class="hasAnchor">
<a href="#styling-example" class="anchor"></a>Styling Example</h4>
<p>Styling can be specified when creating the pivot table. The example below shows specifying styling using a quick-pivot function and using the more verbose syntax.</p>
<div class="sourceCode" id="cb15"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="fu"><a href="reference/qhpvt.html">qhpvt</a></span>(<span class="no">bhmtrains</span>, <span class="st">"TOC"</span>, <span class="st">"TrainCategory"</span>, <span class="st">"n()"</span>,
      <span class="kw">tableStyle</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"border-color"</span><span class="kw">=</span><span class="st">"maroon"</span>),
      <span class="kw">headingStyle</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"color"</span><span class="kw">=</span><span class="st">"cornsilk"</span>, <span class="st">"background-color"</span><span class="kw">=</span><span class="st">"maroon"</span>,
                        <span class="st">"font-style"</span><span class="kw">=</span><span class="st">"italic"</span>, <span class="st">"border-color"</span><span class="kw">=</span><span class="st">"maroon"</span>),
      <span class="kw">cellStyle</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"color"</span><span class="kw">=</span><span class="st">"maroon"</span>, <span class="st">"background-color"</span><span class="kw">=</span><span class="st">"cornsilk"</span>,
                     <span class="st">"border-color"</span><span class="kw">=</span><span class="st">"maroon"</span>),
      <span class="kw">totalStyle</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"color"</span><span class="kw">=</span><span class="st">"maroon"</span>, <span class="st">"background-color"</span><span class="kw">=</span><span class="st">"cornsilk"</span>,
                      <span class="st">"border-color"</span><span class="kw">=</span><span class="st">"maroon"</span>, <span class="st">"font-weight"</span><span class="kw">=</span><span class="st">"bold"</span>))</pre></div>
<div class="sourceCode" id="cb16"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="no">pt</span> <span class="kw">&lt;-</span> <span class="no">PivotTable</span>$<span class="fu">new</span>(<span class="kw">tableStyle</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"border-color"</span><span class="kw">=</span><span class="st">"maroon"</span>),
                     <span class="kw">headingStyle</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"color"</span><span class="kw">=</span><span class="st">"cornsilk"</span>, <span class="st">"background-color"</span><span class="kw">=</span><span class="st">"maroon"</span>,
                                       <span class="st">"font-style"</span><span class="kw">=</span><span class="st">"italic"</span>, <span class="st">"border-color"</span><span class="kw">=</span><span class="st">"maroon"</span>),
                     <span class="kw">cellStyle</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"color"</span><span class="kw">=</span><span class="st">"maroon"</span>, <span class="st">"background-color"</span><span class="kw">=</span><span class="st">"cornsilk"</span>,
                                    <span class="st">"border-color"</span><span class="kw">=</span><span class="st">"maroon"</span>),
                     <span class="kw">totalStyle</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"color"</span><span class="kw">=</span><span class="st">"maroon"</span>, <span class="st">"background-color"</span><span class="kw">=</span><span class="st">"cornsilk"</span>,
                                     <span class="st">"border-color"</span><span class="kw">=</span><span class="st">"maroon"</span>, <span class="st">"font-weight"</span><span class="kw">=</span><span class="st">"bold"</span>))
<span class="no">pt</span>$<span class="fu">addData</span>(<span class="no">bhmtrains</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"TrainCategory"</span>)
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"TOC"</span>)
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"TotalTrains"</span>, <span class="kw">summariseExpression</span><span class="kw">=</span><span class="st">"n()"</span>)
<span class="no">pt</span>$<span class="fu">renderPivot</span>()</pre></div>
<p><img src="http://cbailiss.me.uk/pivottablerreadmeimgs/example5.png" alt="http://cbailiss.me.uk/pivottablerreadmeimgs/example5.png"></p>
<p>It is also possible to change the styling of single cells and ranges of cells after the pivot table has been created. See the “Styling” and “Finding and Formatting” vignettes for more details.</p>
</div>
<div id="excel-output" class="section level4">
<h4 class="hasAnchor">
<a href="#excel-output" class="anchor"></a>Excel Output</h4>
<p>The same styling/formatting used for the HTML output is also used when outputting to Excel - greatly reducing the amount of script that needs to be written to create Excel output.</p>
<div class="sourceCode" id="cb17"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="no">pt</span> <span class="kw">&lt;-</span> <span class="no">PivotTable</span>$<span class="fu">new</span>()
<span class="no">pt</span>$<span class="fu">addData</span>(<span class="no">bhmtrains</span>) <span class="co"># bhmtrains is a data frame with columns TrainCategory, TOC, etc.</span>
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"TrainCategory"</span>) <span class="co"># e.g. Express Passenger</span>
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"TOC"</span>) <span class="co"># TOC = Train Operating Company e.g. Arriva Trains Wales</span>
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"PowerType"</span>) <span class="co"># D/EMU = Diesel/Electric Multiple Unit, HST=High Speed Train</span>
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"TotalTrains"</span>, <span class="kw">summariseExpression</span><span class="kw">=</span><span class="st">"n()"</span>)
<span class="no">pt</span>$<span class="fu">evaluatePivot</span>()

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">openxlsx</span>)
<span class="no">wb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/createWorkbook.html">createWorkbook</a></span>(<span class="kw">creator</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"USERNAME"</span>))
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/addWorksheet.html">addWorksheet</a></span>(<span class="no">wb</span>, <span class="st">"Data"</span>)
<span class="no">pt</span>$<span class="fu">writeToExcelWorksheet</span>(<span class="kw">wb</span><span class="kw">=</span><span class="no">wb</span>, <span class="kw">wsName</span><span class="kw">=</span><span class="st">"Data"</span>,
                         <span class="kw">topRowNumber</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">leftMostColumnNumber</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">applyStyles</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/saveWorkbook.html">saveWorkbook</a></span>(<span class="no">wb</span>, <span class="kw">file</span><span class="kw">=</span><span class="st">"C:\\test.xlsx"</span>, <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></div>
<p><img src="http://cbailiss.me.uk/pivottablerreadmeimgs/example4.png" alt="http://cbailiss.me.uk/pivottablerreadmeimgs/example4.png"></p>
<p>In the screenshot above, Gridlines have been made invisible to make the styling easier to see (by clearing the checkbox on the ‘View’ ribbon). Columns were also auto-sized - though the widths of columns could also be manually specified from R. See the Excel Export vignette for more details.</p>
</div>
</div>
<div id="more-information" class="section level3">
<h3 class="hasAnchor">
<a href="#more-information" class="anchor"></a>More Information</h3>
<p>More complex pivot tables can also be created, e.g. with irregular layouts, using multiple data frames, using multiple calculations and/or custom R calculation functions.</p>
<p>See <a href="http://www.pivottabler.org.uk/articles" class="uri">http://www.pivottabler.org.uk/articles</a> for more detailed information.</p>
</div>
<div id="more-examples" class="section level3">
<h3 class="hasAnchor">
<a href="#more-examples" class="anchor"></a>More Examples</h3>
<p>The following are a few of the example pivot tables constructed in the package vignettes (click to open full sized picture):</p>
<p><img src="http://cbailiss.me.uk/pivottablerreadmeimgs/example3.png" alt="http://cbailiss.me.uk/pivottablerreadmeimgs/example3.png"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=pivottabler">https://​cloud.r-project.org/​package=pivottabler</a>
</li>
<li>Browse source code at <br><a href="https://github.com/cbailiss/pivottabler/">https://​github.com/​cbailiss/​pivottabler/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/cbailiss/pivottabler/issues">https://​github.com/​cbailiss/​pivottabler/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Christopher Bailiss <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/cbailiss/pivottabler"><img src="https://travis-ci.org/cbailiss/pivottabler.svg?branch=master" alt="Build Status"></a></li>
<li><a href="https://cran.r-project.org/package=pivottabler"><img src="http://www.r-pkg.org/badges/version/pivottabler" alt="CRAN_Status_Badge"></a></li>
<li><a href="https://r-pkg.org/pkg/pivottabler"><img src="https://cranlogs.r-pkg.org/badges/grand-total/pivottabler?color=blue" alt="CRAN RStudio mirror downloads"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Christopher Bailiss.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '16a61fa9a8811ff537cd1a528040a9e1',
    indexName: 'pivottabler',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
