<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>13. Excel Export • pivottabler</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="13. Excel Export">
<meta property="og:description" content="pivottabler">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-64707587-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-64707587-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pivottabler</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cbailiss/pivottabler/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="v13-excelexport_files/htmlwidgets-1.5.1/htmlwidgets.js"></script><script src="v13-excelexport_files/pivottabler-binding-1.5.0/pivottabler.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>13. Excel Export</h1>
                        <h4 class="author">Chris Bailiss</h4>
            
            <h4 class="date">2020-06-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cbailiss/pivottabler/blob/master/vignettes/v13-excelexport.Rmd"><code>vignettes/v13-excelexport.Rmd</code></a></small>
      <div class="hidden name"><code>v13-excelexport.Rmd</code></div>

    </div>

    
    
<div id="in-this-vignette" class="section level2">
<h2 class="hasAnchor">
<a href="#in-this-vignette" class="anchor"></a>In This Vignette</h2>
<ul>
<li>Overview</li>
<li>Basic Export (no styling)</li>
<li>Styling and Formatting</li>
<li>Formatting Cell Values</li>
<li>Formatting Headings</li>
<li>Export of NA, NaN, -Inf and Inf</li>
<li>Column Widths and Row Heights</li>
<li>Performance</li>
<li>Styling Reference</li>
<li>Further Reading</li>
</ul>
</div>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The pivottabler package can export a pivot table to an Excel file. Only Excel 2007 onwards (*.xlsx) files are supported. This export uses the openxlsx package.</p>
<p>This vignette starts with a basic (unformatted) export. Following this are various styled/formatted examples.</p>
</div>
<div id="basic-export-no-styling" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-export-no-styling" class="anchor"></a>Basic Export (no styling)</h2>
<p>Exporting a pivot table to an Excel table is reasonably straightforward:</p>
<ol style="list-style-type: decimal">
<li>Create a pivot table in R using <code>pivottabler</code>,</li>
<li>Using the openxlsx package, create a new Excel file and add a worksheet (or open an existing worksheet),</li>
<li>Call the <code>writeToExcelWorksheet</code> method on the pivot table.</li>
<li>Using the openxlsx package, save the workbook.</li>
</ol>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="no">pt</span> <span class="kw">&lt;-</span> <span class="no">PivotTable</span>$<span class="fu">new</span>()
<span class="no">pt</span>$<span class="fu">addData</span>(<span class="no">bhmtrains</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"TrainCategory"</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"PowerType"</span>)
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"TOC"</span>)
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"TotalTrains"</span>, <span class="kw">summariseExpression</span><span class="kw">=</span><span class="st">"n()"</span>)
<span class="no">pt</span>$<span class="fu">evaluatePivot</span>()

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">openxlsx</span>)
<span class="no">wb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/createWorkbook.html">createWorkbook</a></span>(<span class="kw">creator</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"USERNAME"</span>))
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/addWorksheet.html">addWorksheet</a></span>(<span class="no">wb</span>, <span class="st">"Data"</span>)
<span class="no">pt</span>$<span class="fu">writeToExcelWorksheet</span>(<span class="kw">wb</span><span class="kw">=</span><span class="no">wb</span>, <span class="kw">wsName</span><span class="kw">=</span><span class="st">"Data"</span>,
                         <span class="kw">topRowNumber</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">leftMostColumnNumber</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">applyStyles</span><span class="kw">=</span><span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/saveWorkbook.html">saveWorkbook</a></span>(<span class="no">wb</span>, <span class="kw">file</span><span class="kw">=</span><span class="st">"C:\\test.xlsx"</span>, <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<div class="figure">
<img src="excel1.png" alt="Basic Excel Export (unstyled)"><p class="caption">Basic Excel Export (unstyled)</p>
</div>
</div>
<div id="styling-and-formatting" class="section level2">
<h2 class="hasAnchor">
<a href="#styling-and-formatting" class="anchor"></a>Styling and Formatting</h2>
<p>The Excel output from the <code>pivottabler</code> package has been written so that, as much as possible, the same styling used for HTML output also works for the Excel output, i.e. most of the styling described in the <a href="v07-styling.html">Styling</a> vignette can also be used when writing a pivot table to an Excel file.</p>
<p>More specifically, the styling described in the <a href="v07-styling.html">Styling</a> vignette uses CSS (Cascading Style Sheet) definitions for styles. The <code>pivottabler</code> package interprets these CSS definitions and maps them to the styling used in Excel/by the openxlsx package.</p>
<p>This means, once a pivot table has been styled as described in the <a href="v07-styling.html">Styling</a> vignette, the pivot table in the Excel workbook can be styled simply by specifying <code>applyStyles=TRUE</code>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="no">pt</span> <span class="kw">&lt;-</span> <span class="no">PivotTable</span>$<span class="fu">new</span>()
<span class="no">pt</span>$<span class="fu">addData</span>(<span class="no">bhmtrains</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"TrainCategory"</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"PowerType"</span>)
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"TOC"</span>)
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"TotalTrains"</span>, <span class="kw">summariseExpression</span><span class="kw">=</span><span class="st">"n()"</span>)
<span class="no">pt</span>$<span class="fu">evaluatePivot</span>()

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">openxlsx</span>)
<span class="no">wb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/createWorkbook.html">createWorkbook</a></span>(<span class="kw">creator</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"USERNAME"</span>))
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/addWorksheet.html">addWorksheet</a></span>(<span class="no">wb</span>, <span class="st">"Data"</span>)
<span class="no">pt</span>$<span class="fu">writeToExcelWorksheet</span>(<span class="kw">wb</span><span class="kw">=</span><span class="no">wb</span>, <span class="kw">wsName</span><span class="kw">=</span><span class="st">"Data"</span>,
                         <span class="kw">topRowNumber</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">leftMostColumnNumber</span><span class="kw">=</span><span class="fl">1</span>,
                         <span class="kw">applyStyles</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">mapStylesFromCSS</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/saveWorkbook.html">saveWorkbook</a></span>(<span class="no">wb</span>, <span class="kw">file</span><span class="kw">=</span><span class="st">"C:\\test.xlsx"</span>, <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<div class="figure">
<img src="excel2.png" alt="Using CSS Styling"><p class="caption">Using CSS Styling</p>
</div>
<p>In general, the CSS mappings described above will simplify outputting to Excel. However, not all CSS definitions can be mapped to Excel. Excel also has some style settings that don’t map to CSS. There may also be occasions where different styling is desired in Excel vs. HTML. To support all of these scenarios, a second set of styling properties are also supported. These all begin with “xl-” and have roughly similar (but not exactly the same) names to their CSS counterparts, e.g. the property corresponding to CSS “font-family” is “xl-font-name”. If both the “xl-…” Excel property and the CSS property are specified, the Excel value is used. If <code>mapStylesFromCSS=FALSE</code> is specified, then the CSS properties are ignored and only the “xl-…” properties are used.</p>
<p>The table at the bottom of this vignette details the full set of CSS and Excel style properties that are supported.</p>
</div>
<div id="formatting-cell-values" class="section level2">
<h2 class="hasAnchor">
<a href="#formatting-cell-values" class="anchor"></a>Formatting Cell Values</h2>
<p>There are a few different ways for format the values written into the worksheet. These are controlled by the <code>outputValuesAs</code> parameter, which has allowed values: “rawValue”, “formattedValueAsText” and “formattedValueAsNumber”.</p>
<p>The following pivot table will be used to illustrate the different values for this parameter:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lubridate</span>)

<span class="co"># derive some additional data</span>
<span class="no">trains</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="no">bhmtrains</span>,
   <span class="kw">ArrivalDelta</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span>(<span class="no">ActualArrival</span>, <span class="no">GbttArrival</span>, <span class="kw">units</span><span class="kw">=</span><span class="st">"mins"</span>),
   <span class="kw">ArrivalDelay</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">ArrivalDelta</span><span class="kw">&lt;</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="no">ArrivalDelta</span>))

<span class="co"># create the pivot table</span>
<span class="no">pt</span> <span class="kw">&lt;-</span> <span class="no">PivotTable</span>$<span class="fu">new</span>()
<span class="no">pt</span>$<span class="fu">addData</span>(<span class="no">trains</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"TrainCategory"</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"PowerType"</span>)
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"TOC"</span>, <span class="kw">totalCaption</span><span class="kw">=</span><span class="st">"All TOCs"</span>)
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"MeanArrivalDelay"</span>, <span class="kw">caption</span><span class="kw">=</span><span class="st">"Mean Arr. Delay"</span>,
                     <span class="kw">summariseExpression</span><span class="kw">=</span><span class="st">"mean(ArrivalDelay, na.rm=TRUE)"</span>, <span class="kw">format</span><span class="kw">=</span><span class="st">"%.1f"</span>)
<span class="no">pt</span>$<span class="fu">renderPivot</span>()</pre></body></html></div>
<div id="htmlwidget-9cde843e6842dac1d4b3" style="width:auto;height:auto;" class="pivottabler html-widget"></div>
<script type="application/json" data-for="htmlwidget-9cde843e6842dac1d4b3">{"x":{"tableCss":".Table {display: table; border-collapse: collapse; }\r\n.ColumnHeader {font-family: Arial; font-size: 0.75em; border: 1px solid lightgray; vertical-align: middle; font-weight: bold; background-color: #F2F2F2; padding: 2px; text-align: center; }\r\n.RowHeader {font-family: Arial; font-size: 0.75em; border: 1px solid lightgray; vertical-align: middle; font-weight: bold; background-color: #F2F2F2; padding: 2px 8px 2px 2px; text-align: left; }\r\n.Cell {font-family: Arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid lightgray; vertical-align: middle; text-align: right; }\r\n.OutlineColumnHeader {font-family: Arial; font-size: 0.75em; border: 1px solid lightgray; vertical-align: middle; font-weight: bold; background-color: #F2F2F2; padding: 2px; text-align: center; }\r\n.OutlineRowHeader {font-family: Arial; font-size: 0.75em; border: 1px solid lightgray; vertical-align: middle; font-weight: bold; background-color: #F2F2F2; padding: 2px 8px 2px 2px; text-align: left; }\r\n.OutlineCell {font-family: Arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid lightgray; vertical-align: middle; text-align: right; background-color: #F8F8F8; font-weight: bold; }\r\n.Total {font-family: Arial; font-size: 0.75em; padding: 2px 2px 2px 8px; border: 1px solid lightgray; vertical-align: middle; text-align: right; }\r\n","tableHtml":"<table class=\"Table\">\n  <tr>\n    <th class=\"RowHeader\" rowspan=\"2\">&nbsp;<\/th>\n    <th class=\"ColumnHeader\" colspan=\"4\">Express Passenger<\/th>\n    <th class=\"ColumnHeader\" colspan=\"3\">Ordinary Passenger<\/th>\n    <th class=\"ColumnHeader\">Total<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"ColumnHeader\">DMU<\/th>\n    <th class=\"ColumnHeader\">EMU<\/th>\n    <th class=\"ColumnHeader\">HST<\/th>\n    <th class=\"ColumnHeader\">Total<\/th>\n    <th class=\"ColumnHeader\">DMU<\/th>\n    <th class=\"ColumnHeader\">EMU<\/th>\n    <th class=\"ColumnHeader\">Total<\/th>\n    <th class=\"ColumnHeader\">&nbsp;<\/th>\n  <\/tr>\n  <tr>\n    <th class=\"RowHeader\">Arriva Trains Wales<\/th>\n    <td class=\"Cell\">2.3<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Total\">2.3<\/td>\n    <td class=\"Cell\">2.1<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Total\">2.1<\/td>\n    <td class=\"Total\">2.3<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"RowHeader\">CrossCountry<\/th>\n    <td class=\"Cell\">3.5<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\">4.6<\/td>\n    <td class=\"Total\">3.5<\/td>\n    <td class=\"Cell\">NaN<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Total\">NaN<\/td>\n    <td class=\"Total\">3.5<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"RowHeader\">London Midland<\/th>\n    <td class=\"Cell\">1.9<\/td>\n    <td class=\"Cell\">3.2<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Total\">2.7<\/td>\n    <td class=\"Cell\">1.9<\/td>\n    <td class=\"Cell\">2.2<\/td>\n    <td class=\"Total\">2.1<\/td>\n    <td class=\"Total\">2.3<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"RowHeader\">Virgin Trains<\/th>\n    <td class=\"Cell\">3.2<\/td>\n    <td class=\"Cell\">2.9<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Total\">3.0<\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Cell\"><\/td>\n    <td class=\"Total\"><\/td>\n    <td class=\"Total\">3.0<\/td>\n  <\/tr>\n  <tr>\n    <th class=\"RowHeader\">All TOCs<\/th>\n    <td class=\"Total\">3.1<\/td>\n    <td class=\"Total\">3.0<\/td>\n    <td class=\"Total\">4.6<\/td>\n    <td class=\"Total\">3.1<\/td>\n    <td class=\"Total\">2.0<\/td>\n    <td class=\"Total\">2.2<\/td>\n    <td class=\"Total\">2.1<\/td>\n    <td class=\"Total\">2.7<\/td>\n  <\/tr>\n<\/table>","settings":[]},"evals":[],"jsHooks":[]}</script><div id="raw-value" class="section level3">
<h3 class="hasAnchor">
<a href="#raw-value" class="anchor"></a>Raw Value</h3>
<p>Specifying <code>outputValuesAs="rawValue"</code> will output the raw unformatted values. This is also the default if no value is explicitly specified for the <code>outputValuesAs</code> parameter.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lubridate</span>)

<span class="co"># derive some additional data</span>
<span class="no">trains</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="no">bhmtrains</span>,
   <span class="kw">ArrivalDelta</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span>(<span class="no">ActualArrival</span>, <span class="no">GbttArrival</span>, <span class="kw">units</span><span class="kw">=</span><span class="st">"mins"</span>),
   <span class="kw">ArrivalDelay</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">ArrivalDelta</span><span class="kw">&lt;</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="no">ArrivalDelta</span>))

<span class="co"># create the pivot table</span>
<span class="no">pt</span> <span class="kw">&lt;-</span> <span class="no">PivotTable</span>$<span class="fu">new</span>()
<span class="no">pt</span>$<span class="fu">addData</span>(<span class="no">trains</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"TrainCategory"</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"PowerType"</span>)
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"TOC"</span>, <span class="kw">totalCaption</span><span class="kw">=</span><span class="st">"All TOCs"</span>)
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"MeanArrivalDelay"</span>, <span class="kw">caption</span><span class="kw">=</span><span class="st">"Mean Arr. Delay"</span>,
                     <span class="kw">summariseExpression</span><span class="kw">=</span><span class="st">"mean(ArrivalDelay, na.rm=TRUE)"</span>, <span class="kw">format</span><span class="kw">=</span><span class="st">"%.1f"</span>)
<span class="no">pt</span>$<span class="fu">evaluatePivot</span>()

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">openxlsx</span>)
<span class="no">wb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/createWorkbook.html">createWorkbook</a></span>(<span class="kw">creator</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"USERNAME"</span>))
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/addWorksheet.html">addWorksheet</a></span>(<span class="no">wb</span>, <span class="st">"Data"</span>)
<span class="no">pt</span>$<span class="fu">writeToExcelWorksheet</span>(<span class="kw">wb</span><span class="kw">=</span><span class="no">wb</span>, <span class="kw">wsName</span><span class="kw">=</span><span class="st">"Data"</span>,
                         <span class="kw">topRowNumber</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">leftMostColumnNumber</span><span class="kw">=</span><span class="fl">1</span>,
                         <span class="kw">outputValuesAs</span><span class="kw">=</span><span class="st">"rawValue"</span>,
                         <span class="kw">applyStyles</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">mapStylesFromCSS</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/saveWorkbook.html">saveWorkbook</a></span>(<span class="no">wb</span>, <span class="kw">file</span><span class="kw">=</span><span class="st">"C:\\test.xlsx"</span>, <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>Rounding the values as part of the calculation definition is one option that could be used with <code>outputValuesAs="rawValue"</code>.</p>
<div class="figure">
<img src="excel3.png" alt="Exporting raw unformatted values"><p class="caption">Exporting raw unformatted values</p>
</div>
</div>
<div id="formatted-values-as-text" class="section level3">
<h3 class="hasAnchor">
<a href="#formatted-values-as-text" class="anchor"></a>Formatted Values (as text)</h3>
<p>Specifying <code>outputValuesAs="formattedValueAsText"</code> will output the formatted values - i.e. the calculation results that have been formatted according to the <code>format</code> parameter in the <code>defineCalculation()</code> function. The formatted values are text however, so when exported to Excel this typically results in a warning in the corner of each cell that the number in the cell has been stored as text:</p>
<div class="figure">
<img src="excel4.png" alt="Exporting formatted values as text"><p class="caption">Exporting formatted values as text</p>
</div>
</div>
<div id="formatted-values-as-numbers" class="section level3">
<h3 class="hasAnchor">
<a href="#formatted-values-as-numbers" class="anchor"></a>Formatted Values (as numbers)</h3>
<p>Specifying <code>outputValuesAs="formattedValueAsNumber"</code> will output the formatted values as numbers - i.e. the same values as shown in the screen shot above, but converted back to numerical values (where possible) - so eliminating the warnings shown above:</p>
<div class="figure">
<img src="excel5.png" alt="Exporting formatted values as numbers"><p class="caption">Exporting formatted values as numbers</p>
</div>
</div>
<div id="using-excel-to-format-the-values-recommended" class="section level3">
<h3 class="hasAnchor">
<a href="#using-excel-to-format-the-values-recommended" class="anchor"></a>Using Excel to format the values (recommended)</h3>
<p>The <code>outputValuesAs</code> parameter provides a simple way to control value formatting. However, this applies to every cell in the pivot table, so is not a very fine-grained control.</p>
<p>A better option is to output the raw unformatted values to Excel and then specify an Excel format string as part of the calculation definition to allow Excel to format the values.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pivottabler</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lubridate</span>)

<span class="co"># derive some additional data</span>
<span class="no">trains</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="no">bhmtrains</span>,
   <span class="kw">ArrivalDelta</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span>(<span class="no">ActualArrival</span>, <span class="no">GbttArrival</span>, <span class="kw">units</span><span class="kw">=</span><span class="st">"mins"</span>),
   <span class="kw">ArrivalDelay</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">ArrivalDelta</span><span class="kw">&lt;</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="no">ArrivalDelta</span>))

<span class="co"># create the pivot table</span>
<span class="no">pt</span> <span class="kw">&lt;-</span> <span class="no">PivotTable</span>$<span class="fu">new</span>()
<span class="no">pt</span>$<span class="fu">addData</span>(<span class="no">trains</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"TrainCategory"</span>)
<span class="no">pt</span>$<span class="fu">addColumnDataGroups</span>(<span class="st">"PowerType"</span>)
<span class="no">pt</span>$<span class="fu">addRowDataGroups</span>(<span class="st">"TOC"</span>, <span class="kw">totalCaption</span><span class="kw">=</span><span class="st">"All TOCs"</span>)
<span class="no">pt</span>$<span class="fu">defineCalculation</span>(<span class="kw">calculationName</span><span class="kw">=</span><span class="st">"MeanArrivalDelay"</span>, <span class="kw">caption</span><span class="kw">=</span><span class="st">"Mean Arr. Delay"</span>,
                     <span class="kw">summariseExpression</span><span class="kw">=</span><span class="st">"mean(ArrivalDelay, na.rm=TRUE)"</span>, <span class="kw">format</span><span class="kw">=</span><span class="st">"%.1f"</span>,
                     <span class="kw">cellStyleDeclarations</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"xl-value-format"</span><span class="kw">=</span><span class="st">"##0.0"</span>))
<span class="no">pt</span>$<span class="fu">evaluatePivot</span>()

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">openxlsx</span>)
<span class="no">wb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/createWorkbook.html">createWorkbook</a></span>(<span class="kw">creator</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"USERNAME"</span>))
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/addWorksheet.html">addWorksheet</a></span>(<span class="no">wb</span>, <span class="st">"Data"</span>)
<span class="no">pt</span>$<span class="fu">writeToExcelWorksheet</span>(<span class="kw">wb</span><span class="kw">=</span><span class="no">wb</span>, <span class="kw">wsName</span><span class="kw">=</span><span class="st">"Data"</span>,
                         <span class="kw">topRowNumber</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">leftMostColumnNumber</span><span class="kw">=</span><span class="fl">1</span>,
                         <span class="kw">outputValuesAs</span><span class="kw">=</span><span class="st">"rawValue"</span>,
                         <span class="kw">applyStyles</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">mapStylesFromCSS</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/saveWorkbook.html">saveWorkbook</a></span>(<span class="no">wb</span>, <span class="kw">file</span><span class="kw">=</span><span class="st">"C:\\test.xlsx"</span>, <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<div class="figure">
<img src="excel6.png" alt="Exporting raw values with an Excel format string"><p class="caption">Exporting raw values with an Excel format string</p>
</div>
</div>
</div>
<div id="formatting-headings" class="section level2">
<h2 class="hasAnchor">
<a href="#formatting-headings" class="anchor"></a>Formatting Headings</h2>
<p>The formatting of headings is controlled by the <code>outputHeadingsAs</code> parameter, which has allowed values: “rawValue”, “formattedValueAsText” and “formattedValueAsNumber”. The values have the same behaviour as described above for the <code>outputValuesAs</code> parameter. The default value of <code>outputHeadingsAs</code> is “formattedValueAsText”.</p>
<p>Note that specifying <code>outputHeadingsAs="rawValue"</code> will export dates and POSIXct values as numbers (since dates and date/time values are actually represented as numbers in Excel). For numbers, dates and date/time values, specifying an Excel format code when adding the data groups to the pivot table is recommended, e.g. <code>pt$addColumnDataGroups("GbttDate", styleDeclarations=list("xl-value-format"="##0.0"))</code>. This will then ensure they are formatted when exported to Excel using <code>outputHeadingsAs="rawValue"</code>.</p>
</div>
<div id="export-of-na-nan--inf-and-inf" class="section level2">
<h2 class="hasAnchor">
<a href="#export-of-na-nan--inf-and-inf" class="anchor"></a>Export of NA, NaN, -Inf and Inf</h2>
<p>The <code>pt$writeToExcelWorksheet(...)</code> function supports an <code>exportOptions</code> parameter that provides control over how NA, NaN, -Inf and Inf values in R are exported to Excel. See the <a href="vA1-appendix.html">Appendix: Details</a> vignette for details.</p>
</div>
<div id="column-widths-and-row-heights" class="section level2">
<h2 class="hasAnchor">
<a href="#column-widths-and-row-heights" class="anchor"></a>Column Widths and Row Heights</h2>
<p>It is possible to specifying a minimum row height and/or column width as part of the styling. The relevant styling properties are “xl-min-row-height” and “xl-min-column-width”.</p>
<p>Rows/columns are sized to meet all of the minimum sizes specified. E.g. if three cells in the same row have minimum row heights of 40, 45 and 50 specified, the row height will be set to 50.</p>
</div>
<div id="performance" class="section level2">
<h2 class="hasAnchor">
<a href="#performance" class="anchor"></a>Performance</h2>
<p>Creating Excel files is relatively effort intensive. Outputting pivot tables to Excel files requires more time than creating a HTML representation of a pivot table. In order of increasing time required:</p>
<ul>
<li>Unstyled Pivot Tables - these will be written to Excel quicker than styled pivot tables.</li>
<li>Pivot tables using only base styles - i.e. where no additional styles have been applied to individual cells in the pivot table - these take a moderate amount of time to write to Excel.</li>
<li>Pivot tables with styles applied to individual cells - these take the longest amount of time to write to Excel due to the extra effort of handling the styles applied to individual cells.</li>
</ul>
</div>
<div id="styling-reference" class="section level2">
<h2 class="hasAnchor">
<a href="#styling-reference" class="anchor"></a>Styling Reference</h2>
<p>A reference table of the supported styling declarations can be found in the <a href="vA1-appendix.html">Appendix: Details</a> vignette.</p>
</div>
<div id="further-reading" class="section level2">
<h2 class="hasAnchor">
<a href="#further-reading" class="anchor"></a>Further Reading</h2>
<p>The full set of vignettes is:</p>
<ol style="list-style-type: decimal">
<li><a href="v01-introduction.html">Introduction</a></li>
<li><a href="v02-datagroups.html">Data Groups</a></li>
<li><a href="v03-calculations.html">Calculations</a></li>
<li><a href="v04-regularlayout.html">Regular Layout</a></li>
<li><a href="v05-outputs.html">Outputs</a></li>
<li><a href="v06-latexoutput.html">Latex Output</a></li>
<li><a href="v07-styling.html">Styling</a></li>
<li><a href="v08-findingandformatting.html">Finding and Formatting</a></li>
<li><a href="v09-cellcontext.html">Cell Context</a></li>
<li><a href="v10-navigatingapivottable.html">Navigating a Pivot Table</a></li>
<li><a href="v11-irregularlayout.html">Irregular Layout</a></li>
<li><a href="v12-performance.html">Performance</a></li>
<li><a href="v13-excelexport.html">Excel Export</a></li>
<li><a href="v14-shiny.html">Shiny</a></li>
<li><a href="vA1-appendix.html">Appendix: Details</a></li>
<li><a href="vA2-appendix.html">Appendix: Calculations</a></li>
<li><a href="vA3-appendix.html">Appendix: Class Overview</a></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Christopher Bailiss.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '16a61fa9a8811ff537cd1a528040a9e1',
    indexName: 'pivottabler',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
